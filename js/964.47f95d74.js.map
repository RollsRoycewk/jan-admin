{"version":3,"file":"js/964.47f95d74.js","mappings":"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","sources":["webpack://jan-admin/./src/api/role.js","webpack://jan-admin/./src/api/user-mange.js","webpack://jan-admin/./src/views/user-manage/components/Export2ExcelConstants.js","webpack://jan-admin/./src/utils/date.js","webpack://jan-admin/./src/views/user-manage/components/Export2Excel.vue","webpack://jan-admin/./src/views/user-manage/components/Export2Excel.vue?fe4a","webpack://jan-admin/./src/views/user-manage/components/RolesDialog.vue","webpack://jan-admin/./src/views/user-manage/components/RolesDialog.vue?59ea","webpack://jan-admin/./src/views/user-manage/index.vue","webpack://jan-admin/./src/views/user-manage/index.vue?72ec"],"sourcesContent":["// import request from '@/utils/request'\r\n\r\n/**\r\n * 获取所有角色\r\n */\r\nexport const roleList = () => {\r\n  //   return request({\r\n  //     url: '/role/list'\r\n  //   })\r\n\r\n  return [\r\n    {\r\n      id: '1',\r\n      title: '超级管理员',\r\n      describe: '唯一账号，可以操作系统所有功能'\r\n    },\r\n    {\r\n      id: '2',\r\n      title: '管理员',\r\n      describe: '由超管指定，可以为多个，协助超管管理系统'\r\n    },\r\n    {\r\n      id: '3',\r\n      title: '人事经理',\r\n      describe: '主管人事相关业务'\r\n    },\r\n    {\r\n      id: '4',\r\n      title: '销售经理',\r\n      describe: '主管销售相关业务'\r\n    },\r\n    {\r\n      id: '5',\r\n      title: '保安队长',\r\n      describe: '主管安保相关业务'\r\n    },\r\n    {\r\n      id: '6',\r\n      title: '员工',\r\n      describe: '普通员工'\r\n    }\r\n  ]\r\n}\r\n\r\n/**\r\n * 获取指定角色的权限\r\n */\r\nexport const rolePermission = (roleId) => {\r\n  // return request({\r\n  //   url: `/role/permission/${roleId}`\r\n  // })\r\n  return ['1', '1-1', '1-2', '1-3', '2', '2-1', '3', '4', '5']\r\n}\r\n\r\n/**\r\n * 为角色修改权限\r\n */\r\nexport const distributePermission = (data) => {\r\n  // return request({\r\n  //   url: '/role/distribute-permission',\r\n  //   method: 'POST',\r\n  //   data\r\n  // })\r\n  return null\r\n}\r\n","// import request from '@/utils/request'\r\n\r\n/**\r\n * 获取用户列表数据\r\n */\r\nexport const getUserMangeList = (data) => {\r\n  //   return request({\r\n  //     url: '/user-manage/list',\r\n  //     params: data\r\n  //   })\r\n\r\n  return {\r\n    list: [\r\n      {\r\n        role: [\r\n          {\r\n            id: '1',\r\n            title: '超级管理员'\r\n          }\r\n        ],\r\n        _id: '612710a0ec87aa543c9c341d',\r\n        id: '0',\r\n        openTime: '1433088000000',\r\n        username: 'super-admin',\r\n        mobile: '188xxxx0001',\r\n        avatar:\r\n          'https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png'\r\n      },\r\n      {\r\n        role: [\r\n          {\r\n            id: '2',\r\n            title: '管理员'\r\n          }\r\n        ],\r\n        _id: '612710a0ec87aa543c9c341e',\r\n        id: '1',\r\n        username: 'admin',\r\n        openTime: '1559318400000',\r\n        mobile: '188xxxx0002',\r\n        avatar:\r\n          'https://img4.sycdn.imooc.com/61110c2b0001152907400741-140-140.jpg'\r\n      }\r\n    ],\r\n    total: 7,\r\n    page: '1',\r\n    size: '2'\r\n  }\r\n}\r\n\r\n/**\r\n * 批量导入\r\n */\r\nexport const userBatchImport = (data) => {\r\n  // return request({\r\n  //   url: '/user-manage/batch/import',\r\n  //   method: 'POST',\r\n  //   data\r\n  // })\r\n  return null\r\n}\r\n\r\n/**\r\n * 删除指定数据\r\n */\r\nexport const deleteUser = (id) => {\r\n  // return request({\r\n  //   url: `/user-manage/detele/${id}`\r\n  // })\r\n  return true\r\n}\r\n\r\n/**\r\n * 获取所有用户列表数据\r\n */\r\nexport const getUserManageAllList = () => {\r\n  // return request({\r\n  //   url: '/user-manage/all-list'\r\n  // })\r\n  return {\r\n    list: [\r\n      {\r\n        role: [\r\n          {\r\n            id: '1',\r\n            title: '超级管理员'\r\n          }\r\n        ],\r\n        _id: '612710a0ec87aa543c9c341d',\r\n        id: '0',\r\n        openTime: '1433088000000',\r\n        username: 'super-admin',\r\n        mobile: '188xxxx0001',\r\n        avatar:\r\n          'https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png'\r\n      },\r\n      {\r\n        role: [\r\n          {\r\n            id: '2',\r\n            title: '管理员'\r\n          }\r\n        ],\r\n        _id: '612710a0ec87aa543c9c341e',\r\n        id: '1',\r\n        username: 'admin',\r\n        openTime: '1559318400000',\r\n        mobile: '188xxxx0002',\r\n        avatar:\r\n          'https://img4.sycdn.imooc.com/61110c2b0001152907400741-140-140.jpg'\r\n      }\r\n    ],\r\n    total: 7,\r\n    page: '1',\r\n    size: '2'\r\n  }\r\n}\r\n\r\n/**\r\n * 获取用户详情\r\n */\r\nexport const userDetail = (id) => {\r\n  // return request({\r\n  //   url: `/user-manage/detail/${id}`\r\n  // })\r\n  return {\r\n    role: [\r\n      {\r\n        id: '1',\r\n        title: '超级管理员'\r\n      }\r\n    ],\r\n    remark: ['超级管理员', 'BOSS'],\r\n    experience: [\r\n      {\r\n        startTime: '1538323200000',\r\n        endTime: '1551369600000',\r\n        title: '慕课网',\r\n        desc: '混合开发京东商城'\r\n      },\r\n      {\r\n        startTime: '1614528000000',\r\n        endTime: '1625068800000',\r\n        title: '慕课网',\r\n        desc: 'uni-app 开发企业级小程序'\r\n      }\r\n    ],\r\n    _id: '612710a0ec87aa543c9c341d',\r\n    id: '0',\r\n    openTime: '1433088000000',\r\n    username: 'super-admin',\r\n    title: '超级管理员',\r\n    mobile: '188xxxx0001',\r\n    avatar:\r\n      'https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png',\r\n    gender: '男',\r\n    nationality: '汉',\r\n    address: '北京市朝阳区xx大道 11xx0 号 3 层',\r\n    major: '在线职业教育平台',\r\n    glory: '国内领先的线上 IT 教育品牌'\r\n  }\r\n}\r\n\r\n/**\r\n * 获取指定用户角色\r\n */\r\nexport const userRoles = (id) => {\r\n  // return request({\r\n  //   url: `/user-manage/role/${id}`\r\n  // })\r\n  return [{ title: '超级管理员' }]\r\n}\r\n\r\n/**\r\n * 分用户分配角色\r\n */\r\nexport const updateRole = (id, roles) => {\r\n  // return request({\r\n  //   url: `/user-manage/update-role/${id}`,\r\n  //   method: 'POST',\r\n  //   data: {\r\n  //     roles\r\n  //   }\r\n  // })\r\n}\r\n","/**\r\n * 导入数据对应表\r\n */\r\nexport const USER_RELATIONS = {\r\n  姓名: 'username',\r\n  联系方式: 'mobile',\r\n  角色: 'role',\r\n  开通时间: 'openTime'\r\n}\r\n","import dayjs from 'dayjs'\r\nexport const dateFormat = (val, format = 'YYYY-MM-DD') => {\r\n  if (isNaN(val)) {\r\n    return val\r\n  }\r\n  val = parseInt(val)\r\n  return dayjs(val).format(format)\r\n}\r\n","<template>\r\n  <el-dialog\r\n    :title=\"$t('msg.excel.title')\"\r\n    :model-value=\"modelValue\"\r\n    width=\"30%\"\r\n    @close=\"closed\"\r\n  >\r\n    <el-input\r\n      v-model=\"excelName\"\r\n      :placeholder=\"$t('msg.excel.placeholder')\"\r\n    ></el-input>\r\n\r\n    <template #footer>\r\n      <span class=\"dialog-footer\">\r\n        <el-button @click=\"closed\">{{ $t('msg.excel.close') }}</el-button>\r\n        <el-button type=\"primary\" @click=\"onConfirm\" :loading=\"loading\">\r\n          {{ $t('msg.excel.confirm') }}\r\n        </el-button>\r\n      </span>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { watchSwitchLang } from '@/utils/i18n'\r\nimport { defineProps, defineEmits, ref } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { getUserManageAllList } from '@/api/user-mange'\r\nimport { USER_RELATIONS } from './Export2ExcelConstants'\r\nimport { dateFormat } from '@/utils/date'\r\n\r\ndefineProps({\r\n  modelValue: {\r\n    type: Boolean,\r\n    required: true\r\n  }\r\n})\r\n\r\nconst emits = defineEmits(['update:modelValue'])\r\n\r\n/**\r\n * 导出按钮点击事件\r\n */\r\nconst loading = ref(false)\r\nconst onConfirm = async () => {\r\n  loading.value = true\r\n  const allUser = getUserManageAllList().list\r\n  // 导入工具包\r\n  const excel = await import('@/utils/Export2Excel')\r\n  const data = formatJson(USER_RELATIONS, allUser)\r\n  excel.export_json_to_excel({\r\n    // excel 表头\r\n    header: Object.keys(USER_RELATIONS),\r\n    // excel 数据（二维数组结构）\r\n    data,\r\n    // 文件名称\r\n    filename: excelName.value || exportDefaultName,\r\n    // 是否自动列宽\r\n    autoWidth: true,\r\n    // 文件类型\r\n    bookType: 'xlsx'\r\n  })\r\n\r\n  closed()\r\n}\r\n\r\n// 该方法负责将数组转化成二维数组\r\nconst formatJson = (headers, rows) => {\r\n  // 首先遍历数组\r\n  // [{ username: '张三'},{},{}]  => [[’张三'],[],[]]\r\n  return rows.map((item) => {\r\n    return Object.keys(headers).map((key) => {\r\n      // 时间特殊处理\r\n      if (headers[key] === 'openTime') {\r\n        return dateFormat(item[headers[key]])\r\n      }\r\n      // 角色特殊处理\r\n      if (headers[key] === 'role') {\r\n        const roles = item[headers[key]]\r\n\r\n        return JSON.stringify(roles.map((role) => role.title))\r\n      }\r\n      return item[headers[key]]\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * 关闭\r\n */\r\nconst closed = () => {\r\n  emits('update:modelValue', false)\r\n}\r\n\r\nconst i18n = useI18n()\r\nlet exportDefaultName = i18n.t('msg.excel.defaultName')\r\nconst excelName = ref('')\r\n\r\nexcelName.value = exportDefaultName\r\n\r\nwatchSwitchLang(() => {\r\n  exportDefaultName = i18n.t('msg.excel.defaultName')\r\n  excelName.value = exportDefaultName\r\n})\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n","import script from \"./Export2Excel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Export2Excel.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n  <el-dialog\r\n    :title=\"$t('msg.excel.roleDialogTitle')\"\r\n    :model-value=\"modelValue\"\r\n    @close=\"closed\"\r\n  >\r\n    <el-checkbox-group v-model=\"userRoleTitleList\">\r\n      <el-checkbox\r\n        v-for=\"item in allRoleList\"\r\n        :key=\"item.id\"\r\n        :label=\"item.title\"\r\n      ></el-checkbox>\r\n    </el-checkbox-group>\r\n\r\n    <template #footer>\r\n      <span class=\"dialog-footer\">\r\n        <el-button @click=\"closed\">{{ $t('msg.universal.cancel') }}</el-button>\r\n        <el-button type=\"primary\" @click=\"onConfirm\">{{\r\n          $t('msg.universal.confirm')\r\n        }}</el-button>\r\n      </span>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { defineProps, defineEmits, ref, watch } from 'vue'\r\nimport { roleList } from '@/api/role'\r\nimport { watchSwitchLang } from '@/utils/i18n'\r\nimport { userRoles } from '@/api/user-mange'\r\nimport { ElMessage } from 'element-plus'\r\nimport { useI18n } from 'vue-i18n'\r\n\r\nconst props = defineProps({\r\n  modelValue: {\r\n    type: Boolean,\r\n    required: true\r\n  },\r\n  userId: {\r\n    type: String,\r\n    required: true\r\n  }\r\n})\r\n\r\nconst getUserRoles = () => {\r\n  const res = userRoles(props.userId)\r\n  userRoleTitleList.value = res.map((item) => item.title)\r\n}\r\n\r\nwatch(\r\n  () => props.userId,\r\n  (val) => {\r\n    if (val) {\r\n      getUserRoles()\r\n    }\r\n  }\r\n)\r\n\r\n// 所有角色\r\nconst allRoleList = ref([])\r\n// 获取所有角色数据的方法\r\nconst getListData = async () => {\r\n  allRoleList.value = await roleList()\r\n}\r\ngetListData()\r\nwatchSwitchLang(getListData)\r\n\r\n// 当前用户角色\r\nconst userRoleTitleList = ref([])\r\n\r\nconst emits = defineEmits(['update:modelValue', 'updateRole'])\r\n\r\n/**\r\n * 确定按钮点击事件\r\n */\r\nconst i18n = useI18n()\r\nconst onConfirm = async () => {\r\n  // 处理数据结构\r\n  // const roles = userRoleTitleList.value.map((title) => {\r\n  //   return allRoleList.value.find((role) => role.title === title)\r\n  // })\r\n\r\n  // await updateRole(props.userId, roles)\r\n\r\n  ElMessage.success(i18n.t('msg.role.updateRoleSuccess'))\r\n  // 角色更新成功\r\n  emits('updateRole')\r\n  closed()\r\n}\r\n\r\n/**\r\n * 关闭\r\n */\r\nconst closed = () => {\r\n  emits('update:modelValue', false)\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n","import script from \"./RolesDialog.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./RolesDialog.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n  <div class=\"user-manage-container\">\r\n    <el-card class=\"header\">\r\n      <div>\r\n        <el-button\r\n          type=\"primary\"\r\n          @click=\"onImportExcelClick\"\r\n          v-permission=\"['importUser']\"\r\n          >{{ $t('msg.excel.importExcel') }}</el-button\r\n        >\r\n        <el-button type=\"success\" @click=\"onToExcelClick\">{{\r\n          $t('msg.excel.exportExcel')\r\n        }}</el-button>\r\n      </div>\r\n    </el-card>\r\n    <el-card>\r\n      <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n        <el-table-column type=\"index\"></el-table-column>\r\n\r\n        <el-table-column\r\n          prop=\"username\"\r\n          :label=\"$t('msg.excel.name')\"\r\n        ></el-table-column>\r\n\r\n        <el-table-column\r\n          prop=\"mobile\"\r\n          :label=\"$t('msg.excel.mobile')\"\r\n        ></el-table-column>\r\n\r\n        <el-table-column :label=\"$t('msg.excel.avatar')\" align=\"center\">\r\n          <template v-slot=\"{ row }\">\r\n            <el-image\r\n              class=\"avatar\"\r\n              :src=\"row.avatar\"\r\n              :preview-src-list=\"[row.avatar]\"\r\n            ></el-image>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column :label=\"$t('msg.excel.role')\">\r\n          <template #default=\"{ row }\">\r\n            <div v-if=\"row.role && row.role.length > 0\">\r\n              <el-tag size=\"mini\" v-for=\"item in row.role\" :key=\"item.id\">{{\r\n                item.title\r\n              }}</el-tag>\r\n            </div>\r\n            <div v-else size=\"mini\">\r\n              <el-tag size=\"mini\">{{ $t('msg.excel.defaultRole') }}</el-tag>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column prop=\"openTime\" :label=\"$t('msg.excel.openTime')\">\r\n          <template #default=\"{ row }\">\r\n            {{ $filters.dateFilter(row.openTime) }}</template\r\n          >\r\n        </el-table-column>\r\n\r\n        <el-table-column\r\n          :label=\"$t('msg.excel.action')\"\r\n          fixed=\"right\"\r\n          width=\"260\"\r\n        >\r\n          <template #default=\"{ row }\">\r\n            <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              @click=\"onShowClick(row._id)\"\r\n              >{{ $t('msg.excel.show') }}</el-button\r\n            >\r\n            <el-button\r\n              type=\"info\"\r\n              size=\"mini\"\r\n              @click=\"onShowRoleClick(row)\"\r\n              v-permission=\"['distributeRole']\"\r\n              >{{ $t('msg.excel.showRole') }}</el-button\r\n            >\r\n            <el-button\r\n              type=\"danger\"\r\n              size=\"mini\"\r\n              @click=\"onRemoveClick(row)\"\r\n              v-permission=\"['removeUser']\"\r\n              >{{ $t('msg.excel.remove') }}</el-button\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <el-pagination\r\n        class=\"pagination\"\r\n        :total=\"total\"\r\n        :current-page=\"page\"\r\n        :page-size=\"[2, 5, 10, 20]\"\r\n        @current-change=\"handleCurrentChange\"\r\n        @size-change=\"handleSizeChange\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n      ></el-pagination>\r\n\r\n      <export-to-excel v-model=\"exportToExcelVisible\"></export-to-excel>\r\n      <roles-dialog\r\n        v-model=\"roleDialogVisible\"\r\n        :userId=\"selectUserId\"\r\n        @updateRole=\"getListData\"\r\n      ></roles-dialog>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { getUserMangeList, deleteUser } from '@/api/user-mange'\r\nimport { ref, onActivated, watch } from 'vue'\r\nimport { watchSwitchLang } from '@/utils/i18n'\r\nimport { useRouter } from 'vue-router'\r\nimport { ElMessageBox, ElMessage } from 'element-plus'\r\nimport { useI18n } from 'vue-i18n'\r\nimport ExportToExcel from './components/Export2Excel.vue'\r\nimport RolesDialog from './components/RolesDialog.vue'\r\n\r\n// 数据相关\r\nconst tableData = ref([])\r\nconst total = ref(0)\r\nconst page = ref(1)\r\nconst size = ref(2)\r\n\r\n// 获取数据的方法\r\nconst getListData = () => {\r\n  const result = getUserMangeList({\r\n    page: page.value,\r\n    size: size.value\r\n  })\r\n\r\n  tableData.value = result.list\r\n  total.value = result.total\r\n}\r\n\r\ngetListData()\r\n// 监听语言切换\r\nwatchSwitchLang(getListData)\r\n\r\n/**\r\n * size 改变触发\r\n */\r\nconst handleSizeChange = (currentSize) => {\r\n  size.value = currentSize\r\n  getListData()\r\n}\r\n\r\n/**\r\n * 页码改变触发\r\n */\r\nconst handleCurrentChange = (currentPage) => {\r\n  page.value = currentPage\r\n  getListData()\r\n}\r\n\r\nconst router = useRouter()\r\n\r\nconst onImportExcelClick = () => {\r\n  router.push('/user/import')\r\n}\r\n\r\n// 处理导入用户后数据不重新加载的问题\r\nonActivated(getListData)\r\n\r\n/**\r\n * 删除按钮点击事件\r\n */\r\nconst i18n = useI18n()\r\nconst onRemoveClick = (row) => {\r\n  ElMessageBox.confirm(\r\n    i18n.t('msg.excel.dialogTitle1') +\r\n      row.username +\r\n      i18n.t('msg.excel.dialogTitle2'),\r\n    {\r\n      type: 'warning'\r\n    }\r\n  ).then(async () => {\r\n    await deleteUser(row._id)\r\n    ElMessage.success(i18n.t('msg.excel.removeSuccess'))\r\n    // 重新渲染数据\r\n    getListData()\r\n  })\r\n}\r\n\r\n/**\r\n * excel导出点击事件\r\n */\r\nconst exportToExcelVisible = ref(false)\r\n\r\nconst onToExcelClick = () => {\r\n  exportToExcelVisible.value = true\r\n}\r\n\r\n/**\r\n * 查看按钮点击事件\r\n */\r\nconst onShowClick = (id) => {\r\n  router.push(`/user/info/${id}`)\r\n}\r\n\r\n/**\r\n * 查看角色的点击事件\r\n */\r\nconst roleDialogVisible = ref(false)\r\nconst selectUserId = ref('')\r\nconst onShowRoleClick = (row) => {\r\n  roleDialogVisible.value = true\r\n  selectUserId.value = row._id\r\n}\r\n\r\n// 保证每次打开重新获取用户角色数据\r\nwatch(roleDialogVisible, (val) => {\r\n  if (!val) selectUserId.value = ''\r\n})\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.user-manage-container {\r\n  .header {\r\n    margin-bottom: 22px;\r\n    text-align: right;\r\n  }\r\n\r\n  :deep(.avatar) {\r\n    width: 60px;\r\n    height: 60px;\r\n    border-radius: 50%;\r\n  }\r\n\r\n  :depp(.el-tag) {\r\n    margin-right: 6px;\r\n  }\r\n\r\n  .pagination {\r\n    margin-top: 20px;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=d42cec92&lang=scss&scoped=true\"\n\nimport exportComponent from \"G:\\\\RollsRoycewkk\\\\jan-admin\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-d42cec92\"]])\n\nexport default __exports__"],"names":["roleList","id","title","describe","rolePermission","roleId","getUserMangeList","data","list","role","_id","openTime","username","mobile","avatar","total","page","size","userBatchImport","deleteUser","getUserManageAllList","userDetail","remark","experience","startTime","endTime","desc","gender","nationality","address","major","glory","userRoles","USER_RELATIONS","姓名","联系方式","角色","开通时间","dateFormat","val","format","isNaN","parseInt","dayjs","loading","ref","onConfirm","async","value","allUser","excel","formatJson","export_json_to_excel","header","Object","keys","filename","excelName","exportDefaultName","autoWidth","bookType","closed","headers","rows","map","item","key","roles","JSON","stringify","emits","i18n","useI18n","t","watchSwitchLang","__exports__","getUserRoles","res","props","userId","userRoleTitleList","watch","allRoleList","getListData","ElMessage","tableData","result","handleSizeChange","currentSize","handleCurrentChange","currentPage","router","useRouter","onImportExcelClick","push","onActivated","onRemoveClick","row","ElMessageBox","type","then","exportToExcelVisible","onToExcelClick","onShowClick","roleDialogVisible","selectUserId","onShowRoleClick"],"sourceRoot":""}